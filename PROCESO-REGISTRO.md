# üìù Proceso de Registro - Documentaci√≥n

## üéØ Descripci√≥n General

El proceso de registro de UBIKHA es un **flujo multi-paso de 3 etapas** dise√±ado para capturar la informaci√≥n del usuario de forma progresiva y validar su identidad mediante verificaci√≥n telef√≥nica.

## üöÄ Flujo del Proceso

```mermaid
graph TD
    A[üë§ Usuario entra a /register] --> B[üì± Paso 1: N√∫mero de Tel√©fono]
    B --> C{‚úÖ N√∫mero V√°lido?}
    C -->|‚ùå No| B
    C -->|‚úÖ S√≠| D[üì≤ Paso 2: Verificaci√≥n SMS]
    D --> E{üî¢ C√≥digo Correcto?}
    E -->|‚ùå No| F[üîÑ Reenviar C√≥digo]
    F --> E
    E -->|‚úÖ S√≠| G[üìã Paso 3: Datos Personales]
    G --> H{üìù Datos V√°lidos?}
    H -->|‚ùå No| G
    H -->|‚úÖ S√≠| I[üéâ Registro Completado]
    I --> J[üè† Redirect a Dashboard]
```

## üèóÔ∏è Arquitectura de Componentes

### Componentes Principales

1. **`RegisterPage.tsx`** - Componente orquestador principal
2. **`RegisterStepOne.tsx`** - Captura n√∫mero de tel√©fono
3. **`RegisterStepTwo.tsx`** - Verificaci√≥n de c√≥digo SMS
4. **`RegisterStepThree.tsx`** - Datos personales y contrase√±a

### Estructura de Datos

```typescript
interface FormData {
  num_celular: string;           // Paso 1
  verification_code: string;     // Paso 2
  nombres: string;              // Paso 3
  apellidos: string;            // Paso 3
  fecha_nacimiento: string;     // Paso 3
  email: string;                // Paso 3
  password: string;             // Paso 3
}
```

## üì± Paso 1: N√∫mero de Tel√©fono

### Prop√≥sito
Capturar y validar el n√∫mero de tel√©fono del usuario como identificador principal.

### Campos
- **N√∫mero de tel√©fono** (requerido)
  - Formato: 9 d√≠gitos
  - Validaci√≥n: Debe empezar con 9 (n√∫meros peruanos)
  - M√°ximo: 9 caracteres num√©ricos

### Validaciones
```typescript
const phoneRegex = /^9\d{8}$/; // N√∫meros de Per√∫
```

### Funcionalidades
- ‚úÖ Validaci√≥n en tiempo real
- ‚úÖ Limpieza autom√°tica de caracteres no num√©ricos
- ‚úÖ Botones de redes sociales (deshabilitados - pr√≥ximamente)
- ‚úÖ Navegaci√≥n hacia atr√°s (Login)

### Ubicaci√≥n
- **Archivo:** `src/components/ui/RegisterStepOne/RegisterStepOne.tsx`
- **Estilos:** `src/components/ui/RegisterStepOne/RegisterStepOne.css`

---

## üî¢ Paso 2: Verificaci√≥n SMS

### Prop√≥sito
Verificar la identidad del usuario mediante c√≥digo SMS de 6 d√≠gitos.

### Campos
- **C√≥digo de verificaci√≥n** (6 d√≠gitos)
  - Formato: 6 inputs individuales num√©ricos
  - Validaci√≥n: Solo n√∫meros
  - Auto-focus y navegaci√≥n autom√°tica entre campos

### Funcionalidades
- ‚úÖ **Auto-avance**: Al escribir un d√≠gito, avanza al siguiente campo
- ‚úÖ **Backspace inteligente**: Navega hacia atr√°s autom√°ticamente
- ‚úÖ **Pegar c√≥digo**: Soporta pegar c√≥digo completo de 6 d√≠gitos
- ‚úÖ **Reenv√≠o de c√≥digo**: Bot√≥n para solicitar nuevo c√≥digo
- ‚úÖ **Modo desarrollo**: Acepta cualquier c√≥digo de 6 d√≠gitos

### Validaciones
```typescript
// Solo d√≠gitos num√©ricos
if (value && !/^\d$/.test(value)) return;

// C√≥digo completo de 6 d√≠gitos
if (fullCode.length !== 6) {
  setError('Por favor ingresa el c√≥digo completo de 6 d√≠gitos');
}
```

### Ubicaci√≥n
- **Archivo:** `src/components/ui/RegisterStepTwo/RegisterStepTwo.tsx`
- **Estilos:** `src/components/ui/RegisterStepTwo/RegisterStepTwo.css`

### Estado de Desarrollo
> üí° **Nota:** Actualmente en modo desarrollo - acepta cualquier c√≥digo de 6 d√≠gitos.  
> Para producci√≥n se debe implementar integraci√≥n con servicio SMS real.

---

## üìã Paso 3: Datos Personales

### Prop√≥sito
Capturar informaci√≥n personal completa del usuario y configurar credenciales de acceso.

### Campos Requeridos

| Campo | Tipo | Validaci√≥n | Descripci√≥n |
|-------|------|------------|-------------|
| **Nombres** | `text` | Min: 2 caracteres | Nombre que aparece en DNI |
| **Apellidos** | `text` | Min: 2 caracteres | Apellidos que aparecen en DNI |
| **Fecha de Nacimiento** | `date` | Edad: 18-100 a√±os | Fecha de nacimiento v√°lida |
| **Email** | `email` | Formato email v√°lido | Correo electr√≥nico √∫nico |
| **Contrase√±a** | `password` | 6-20 caracteres | Contrase√±a de acceso |
| **Confirmar Contrase√±a** | `password` | Igual a contrase√±a | Confirmaci√≥n de contrase√±a |

### Validaciones Espec√≠ficas

#### Edad M√≠nima
```typescript
const birthDate = new Date(fecha_nacimiento);
const age = today.getFullYear() - birthDate.getFullYear();

if (age < 18) {
  error = 'Debes ser mayor de 18 a√±os';
}
```

#### Contrase√±as
```typescript
// Contrase√±a principal
if (password.length < 6) {
  error = 'La contrase√±a debe tener al menos 6 caracteres';
}

// Confirmaci√≥n
if (password !== confirm_password) {
  error = 'Las contrase√±as no coinciden';
}
```

#### Email
```typescript
const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
if (!emailRegex.test(email)) {
  error = 'Ingresa un email v√°lido';
}
```

### Funcionalidades
- ‚úÖ **Validaci√≥n en tiempo real**: Errores se muestran mientras se escribe
- ‚úÖ **Limpieza autom√°tica**: Se eliminan espacios en blanco extras
- ‚úÖ **Fecha inteligente**: Rangos de fecha autom√°ticos (18-100 a√±os)
- ‚úÖ **Estado de carga**: Loading durante el env√≠o
- ‚úÖ **Manejo de errores**: Errores espec√≠ficos por campo

### Ubicaci√≥n
- **Archivo:** `src/components/ui/RegisterStepThree/RegisterStepThree.tsx`
- **Estilos:** `src/components/ui/RegisterStepThree/RegisterStepThree.css`

---

## üéõÔ∏è Gesti√≥n de Estado

### RegisterPage.tsx - Orquestador Principal

```typescript
const [currentStep, setCurrentStep] = useState(1); // Paso actual
const [formData, setFormData] = useState({...});   // Datos acumulados
```

### Navegaci√≥n Entre Pasos

#### Avanzar (Next)
```typescript
const handleNextStep = (stepData: any) => {
  setFormData({ ...formData, ...stepData });
  setCurrentStep(currentStep + 1);
};
```

#### Retroceder (Back)
```typescript
const handlePrevStep = () => {
  if (currentStep > 1) {
    setCurrentStep(currentStep - 1);
  }
};
```

### Flujo de Datos
1. **Paso 1** ‚Üí `{ num_celular: "999999999" }`
2. **Paso 2** ‚Üí `{ num_celular: "999999999", verification_code: "123456" }`
3. **Paso 3** ‚Üí `{ ...datosAnteriores, nombres: "...", apellidos: "...", ... }`

---

## üõ†Ô∏è Integraci√≥n con Backend

### Estado Actual: Modo Desarrollo
```typescript
// RegisterPage.tsx - l√≠neas 58-68
// TODO: Llamar al servicio de registro cuando est√© implementado
// try {
//   await authService.register(completeData);
//   navigate('/login');
// } catch (error) {
//   console.error('Error en registro:', error);
// }

// Por ahora, solo navegamos al dashboard
alert('Registro completado (simulado). Datos en consola.');
navigate('/home-arrendatario');
```

### Implementaci√≥n Futura
Para conectar con el backend, se debe:

1. **Crear endpoint de registro** en `authService.ts`
2. **Implementar servicio SMS** para verificaci√≥n
3. **Manejar errores de registro** (email duplicado, etc.)
4. **Configurar redirecci√≥n** seg√∫n tipo de usuario

```typescript
// Ejemplo de implementaci√≥n futura
const handleFinalSubmit = async (finalData: any) => {
  try {
    const response = await authService.register({
      ...formData,
      ...finalData
    });
    
    // Redirigir seg√∫n rol del usuario
    const redirectPath = authService.getRedirectPath(response.rol);
    navigate(redirectPath);
    
  } catch (error) {
    setError('Error al registrar usuario');
  }
};
```

---

## üé® Estilos y UX

### Caracter√≠sticas de Dise√±o
- **Dise√±o responsivo**: Funciona en m√≥viles y desktop
- **Feedback visual**: Estados de error, carga y √©xito
- **Navegaci√≥n intuitiva**: Botones de retroceso en cada paso
- **Consistencia visual**: Misma estructura en los 3 pasos

### Paleta de Colores (basada en CSS existente)
- **Primario**: Azul UBIKHA
- **Errores**: Rojo para campos inv√°lidos
- **√âxito**: Verde para validaciones correctas
- **Fondo**: Gris claro (`#f8fafc`)

---

## üö¶ Rutas y Navegaci√≥n

### Configuraci√≥n en AppRouter.tsx
```typescript
<Route path="/register" element={<RegisterPage />} />
```

### Flujo de Navegaci√≥n
```
/login ‚Üí [Click "Registrarse"] ‚Üí /register ‚Üí [3 pasos] ‚Üí /home-arrendatario
```

### Navegaci√≥n Interna
- **Paso 1** ‚Üí Back: `/login`
- **Paso 2** ‚Üí Back: Paso 1
- **Paso 3** ‚Üí Back: Paso 2
- **Completado** ‚Üí Redirect: `/home-arrendatario`

---

## üîß Para Desarrolladores

### Comandos √ötiles
```bash
npm run dev    # Servidor de desarrollo
npm run build  # Build de producci√≥n
npm run lint   # Verificar c√≥digo
```

### Testing Manual
1. Ir a `http://localhost:5173/register`
2. **Paso 1**: Usar cualquier n√∫mero de 9 d√≠gitos que empiece con 9
3. **Paso 2**: Usar cualquier c√≥digo de 6 d√≠gitos (modo desarrollo)
4. **Paso 3**: Llenar todos los campos con datos v√°lidos

### Debug
- **Console logs**: Cada paso imprime los datos acumulados
- **React DevTools**: Inspeccionar estado de `RegisterPage`
- **Network tab**: Preparado para futuras llamadas API

---

## ‚úÖ Estado del Desarrollo

### ‚úÖ Completado
- [x] Estructura de 3 pasos
- [x] Validaciones por campo
- [x] Navegaci√≥n entre pasos
- [x] Interfaz de usuario responsive
- [x] Manejo de errores
- [x] Integraci√≥n con sistema de rutas

### ‚è≥ Pendiente
- [ ] Integraci√≥n con backend real
- [ ] Servicio SMS real para verificaci√≥n
- [ ] Manejo de usuarios duplicados
- [ ] Tests unitarios
- [ ] Internacionalizaci√≥n (i18n)
- [ ] Botones de redes sociales funcionales

### üêõ Issues Conocidos
- Los botones de Google/Facebook est√°n deshabilitados
- El c√≥digo SMS acepta cualquier valor (modo desarrollo)
- No hay persistencia en localStorage (se pierde al recargar)

---

## üìö Referencias T√©cnicas

### Componentes Base Utilizados
- `Input` - Campo de entrada reutilizable
- `Button` - Bot√≥n base con estados
- `React Router` - Navegaci√≥n SPA

### Dependencias
- `react-icons` - Iconograf√≠a (IoArrowBack, FaFacebookF, FcGoogle)
- `react-router-dom` - Enrutamiento
- `typescript` - Tipado est√°tico

### Archivos Relacionados
```
src/
‚îú‚îÄ‚îÄ components/ui/
‚îÇ   ‚îú‚îÄ‚îÄ RegisterStepOne/
‚îÇ   ‚îú‚îÄ‚îÄ RegisterStepTwo/
‚îÇ   ‚îú‚îÄ‚îÄ RegisterStepThree/
‚îÇ   ‚îî‚îÄ‚îÄ index.ts (exports)
‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îú‚îÄ‚îÄ RegisterPage.tsx
‚îÇ   ‚îî‚îÄ‚îÄ index.ts (exports)
‚îî‚îÄ‚îÄ router/
    ‚îî‚îÄ‚îÄ AppRouter.tsx
```

---

*Documentaci√≥n generada el: {{ fecha actual }}*  
*Versi√≥n: 1.0.0*  
*Estado: Desarrollo (Plantillas listas para integraci√≥n)*